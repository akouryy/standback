# (?i:standback) 仕様

まずは[Rubyの正規表現](https://docs.ruby-lang.org/ja/latest/doc/spec=2fregexp.html)を見ましょう

## プログラムの構造(文法)
* プログラム全体は1つのブロックである
* ブロックは0個以上のコマンドの並びであり、コマンドの間や前後には空白を入れてもよい
  * `#コメント`のような`#`で始まる行コメントも入れられる
* コマンドは以下のものがある。コマンド名は1文字で、それに続いて0個以上の引数がある。コマンド名と引数の間、引数間、最後の引数の後には`/`を入れる。
* 文字列は`/, \, %`のみエスケープできる(`\/, \\, \%`)。エスケープのない`%`は変数展開に使われることもある(後述)。
* 正規表現は[Rubyと同じ](https://docs.ruby-lang.org/ja/latest/doc/spec=2fregexp.html)ように書ける

## コマンド
以下は`a`に対する操作(後述)である。

| コマンド | 説明 |
| --- | --- |
| `c/関数名:文字列/` | 関数呼び出し。引数はなくグローバル変数(後述)で渡す。 |
| `d/関数名:文字列/本体:ブロック/` | 関数定義(未検証) |
| `g/正規表現/置換文字列/` | `a`を全置換(RubyのString#gsub)。replace部分に\1などを書いてもただの1になる。正しくは`%1`(後述)。 |
| `m/正規表現/真ブロック/偽ブロック/` | 条件分岐(正規表現がaにマッチするかどうか) |
| `q/` | `a`をエラー出力しプログラムを直ちに異常終了させる(ただし`a`が空文字列の場合何も出力せず正常終了する) |
| `s/正規表現/置換文字列/` | `a`を置換(String#sub) |
| `t/置換前文字列/置換後文字列/` | `a`を全置換(String#tr) |
| `w/正規表現/ブロック/` | `a`にマッチする間繰り返し(while) |

## 変数
* `a`と`A`の2つのグローバルな文字列がある
  * 上のコマンドの最初の文字を大文字にすると`A`に対する操作になる。ただしブロック引数には影響しない。
    * たとえば`Q/`は`A`をエラー出力しプログラムを直ちに異常終了させるのでデバッグに便利
  * 関数呼び出しを大文字Cにすると関数の本体の中で`a`と`A`が入れ替わる
    * たとえば下の`c/\//`は`na`を`na/nA`に置換するが、`C/\//`は`nA`を`nA/na`に置換する
  * グローバル変数の初期値は`a`が入力全体、`A`は空文字列である。プログラム終了時`A`が出力される。
* 正規表現をとるコマンドでは正規表現より右の引数で`%2, %&`等([RubyのKernel特殊変数](https://docs.ruby-lang.org/ja/latest/class/Kernel.html)の正規表現関連の変数の$を%に変えたもの)を使える
  * ネストする場合は`%%2, %%%%%'`など%の数で深さを指定する。`%`を`\%`に変えるとただの%と解釈される。

## 標準関数
* `ord`: `a`の`/^-?\d+(\.\d+)?/`にマッチする部分文字列 (以下、これをnaと呼ぶ) をその文字コードを持つ文字に置換
* `chr`: `a/^./`をその文字コードに置換
* `+`: `na`を`na+nA`に置換
* `/`: `na`を`na/nA`に置換 (-Infinityとかにも置換されうる)

## 例
[/examples/](examples)
